---
id: DS-018
title: Hover Preview + Backlinks
type: feature
epic: EPIC-004
status: done
sprint: phase-4
size: M
assignee: ""
dependencies:
  - DS-016
created: 2025-11-26
updated: 2025-11-28
---

# Hover Preview + Backlinks

## Description
Rich hover cards showing story/epic details when hovering over `[[ID]]` links, plus a backlinks panel showing incoming references.

## Acceptance Criteria

### MVP
- [x] Implement `HoverProvider` interface
- [x] Hover over `[[ID]]` shows markdown card with:
  - Title (as heading)
  - Status with colored indicator
  - Type with icon
  - Size
  - Epic name (for stories)
- [x] Returns null/empty if ID not found
- [x] Hover card is readable and well-formatted

### Enhanced
- [ ] **Backlinks section in hover**: "Referenced by: [[DS-002]], [[DS-005]]"
- [ ] **Backlinks panel**: Dedicated view showing all stories that link to current file
- [ ] **Progress in epic hover**: Show "3/5 stories done" when hovering epic link
- [ ] **Dependencies warning**: Show if story has unfinished dependencies
- [ ] **Quick actions in hover**: Links to "Open file", "Change status"

## Technical Notes
- Register: `vscode.languages.registerHoverProvider('markdown', provider)`
- Hover content uses `vscode.MarkdownString` (supports markdown + icons)
- Backlinks: Query the reverse index built in DS-016
- Status colors: Use emoji or unicode circles (‚óè‚óã‚óê‚óë)

## Hover Card Design

```markdown
### üìã DS-001: Project Scaffolding

**Status:** ‚óè Done
**Type:** ‚ú® Feature
**Size:** S
**Epic:** Phase 1: Foundation

---

**Referenced by:**
[[DS-002]], [[DS-004]], [[DS-006]]
```

## Implementation

```typescript
class StoryHoverProvider implements vscode.HoverProvider {
  provideHover(document: vscode.TextDocument, position: vscode.Position): vscode.Hover | null {
    const range = document.getWordRangeAtPosition(position, /\[\[([A-Z]+-\d+)\]\]/);
    if (!range) return null;

    const text = document.getText(range);
    const id = text.slice(2, -2); // Remove [[ and ]]
    const item = this.store.getStory(id) || this.store.getEpic(id);
    if (!item) return null;

    const md = new vscode.MarkdownString();
    md.appendMarkdown(`### ${this.getIcon(item.type)} ${item.title}\n\n`);
    md.appendMarkdown(`**Status:** ${this.getStatusIndicator(item.status)}\n`);
    // ... more fields

    return new vscode.Hover(md, range);
  }
}
```

## Backlinks Panel (Enhanced)

Add a "Backlinks" section to the sidebar (below Stories tree):

```
BACKLINKS (for DS-004)
‚îú‚îÄ‚îÄ DS-006 - TreeDataProvider
‚îú‚îÄ‚îÄ DS-009 - Progress Bar
‚îî‚îÄ‚îÄ DS-015 - Change Status Command
```

Shows stories that contain `[[DS-004]]` in their content.
