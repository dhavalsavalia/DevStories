---
id: DS-019
title: Webview Foundation + Theme
type: feature
epic: EPIC-005
status: todo
sprint: phase-5
size: M
assignee: ""
dependencies:
  - DS-004
created: 2025-11-26
updated: 2025-11-28
---

# Webview Foundation + Theme

## Description
Set up the webview infrastructure for the Kanban board with proper VS Code theme integration and bidirectional communication.

## Acceptance Criteria

### MVP
- [ ] `WebviewViewProvider` registered for board view
- [ ] Webview loads HTML content from bundled files
- [ ] Extension sends initial data (stories, statuses) to webview via postMessage
- [ ] Webview can send messages back to extension
- [ ] Basic error handling for communication failures

### Enhanced
- [ ] **VS Code theme integration**: Board uses VS Code's CSS variables for colors
- [ ] **Dark/light mode**: Automatically matches VS Code theme
- [ ] **Webview state persistence**: Restore scroll position, collapsed columns on reload
- [ ] **Loading state**: Show skeleton/spinner while data loads
- [ ] **Connection status**: Indicator if webview loses sync with extension

## Technical Notes
- WebviewViewProvider vs WebviewPanel: Use ViewProvider for sidebar integration
- CSP (Content Security Policy): Must allow scripts, styles from webview
- Theme CSS vars: `--vscode-editor-background`, `--vscode-foreground`, etc.
- State persistence: Use `webview.setState()` and `getState()`

## Message Protocol

### Extension → Webview
```typescript
// Initial load
{ type: 'init', payload: { stories: Story[], statuses: Status[] } }

// Story updated (from file change)
{ type: 'storyUpdated', payload: { story: Story } }

// Story deleted
{ type: 'storyDeleted', payload: { id: string } }
```

### Webview → Extension
```typescript
// Status change from drag-drop
{ type: 'updateStatus', payload: { storyId: string, newStatus: string } }

// Request to open story file
{ type: 'openStory', payload: { id: string } }

// Filter changed
{ type: 'filterChanged', payload: { sprint: string | null, epic: string | null } }
```

## Webview HTML Structure

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="...">
  <link href="${styleUri}" rel="stylesheet">
</head>
<body>
  <div id="board-root">
    <div class="board-header"><!-- filters --></div>
    <div class="board-columns"><!-- kanban columns --></div>
  </div>
  <script src="${scriptUri}"></script>
</body>
</html>
```

## Theme Variables (VS Code)

```css
:root {
  --card-bg: var(--vscode-editor-background);
  --card-border: var(--vscode-panel-border);
  --card-text: var(--vscode-foreground);
  --column-bg: var(--vscode-sideBar-background);
  --accent: var(--vscode-focusBorder);
}
```
