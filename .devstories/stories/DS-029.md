---
id: DS-029
title: startSprint + closeSprint commands
type: feature
epic: EPIC-006
status: todo
sprint: backlog
size: M
assignee: ""
dependencies:
  - DS-027
  - DS-028
created: 2025-11-28
updated: 2025-11-28
---

# startSprint + closeSprint commands

## Description

Implement sprint lifecycle commands to start (activate) and close (complete) sprints with proper state transitions and handling of incomplete stories.

## startSprint Command

### User Flow

1. **Trigger**: Command palette → "DevStories: Start Sprint"
2. **QuickPick**: Show planned sprints
   ```
   Select sprint to start:
   ○ Sprint 6 - Payments (Dec 1 - Dec 14)
   ○ Sprint 7 - Notifications (Dec 15 - Dec 28)
   ```
3. **Confirm**: "Start Sprint 6? This will set it as the current sprint."
4. **Action**:
   - Set sprint status to "active"
   - Update `sprints.current` to this sprint ID
   - If another sprint is active → set it to "planned" (or warn)
5. **Result**: Notification + board auto-filters to new sprint

### Rules

- Only ONE sprint can be "active" at a time
- Starting a sprint sets `sprints.current`
- Board view auto-updates to show new sprint

## closeSprint Command

### User Flow

1. **Trigger**: Command palette → "DevStories: Close Sprint"
2. **Show Summary**:
   ```
   Close Sprint 5?

   ✅ Completed: 8 stories
   ⚠️ Incomplete: 2 stories
     - DS-045: Fix login bug (in_progress)
     - DS-048: Add logout (todo)
   ```
3. **QuickPick for Incomplete Stories**:
   ```
   What to do with incomplete stories?
   ○ Move all to next sprint (Sprint 6)
   ○ Move all to backlog
   ○ Choose for each story
   ```
4. **Action**:
   - Set sprint status to "completed"
   - Update incomplete stories' sprint field
   - Clear `sprints.current` if no next sprint
   - Calculate velocity (optional)
5. **Optional**: Prompt to start next sprint

### Rules

- Only active sprint can be closed
- Must handle incomplete stories before closing
- Completed sprints are read-only (no editing)

## Acceptance Criteria

### startSprint
- [ ] Register `devstories.startSprint` command
- [ ] Show planned sprints in QuickPick
- [ ] Confirmation dialog
- [ ] Update sprint status in config.yaml
- [ ] Update `sprints.current`
- [ ] Handle case: another sprint already active
- [ ] Refresh board view with new sprint filter
- [ ] Show success notification

### closeSprint
- [ ] Register `devstories.closeSprint` command
- [ ] Show sprint summary (completed vs incomplete)
- [ ] Handle incomplete stories dialog
- [ ] Update sprint status to "completed"
- [ ] Move incomplete stories as specified
- [ ] Calculate and store velocity (stories completed)
- [ ] Prompt to start next sprint (if exists)
- [ ] Show success notification

## Technical Notes

### State Machine

```
[No Sprint] ──createSprint──→ [Planned]
[Planned] ──startSprint──→ [Active]
[Active] ──closeSprint──→ [Completed]

Constraints:
- Max 1 active sprint
- Completed sprints cannot transition
- Planned → Completed not allowed (must start first)
```

### Incomplete Stories Handler

```typescript
async function handleIncompleteStories(
  stories: Story[],
  nextSprint: string | null
): Promise<void> {
  const choice = await vscode.window.showQuickPick([
    { label: 'Move to next sprint', value: 'next' },
    { label: 'Move to backlog', value: 'backlog' },
    { label: 'Choose individually', value: 'individual' },
  ]);

  switch (choice.value) {
    case 'next':
      await bulkUpdateSprint(stories, nextSprint);
      break;
    case 'backlog':
      await bulkUpdateSprint(stories, 'backlog');
      break;
    case 'individual':
      for (const story of stories) {
        // Show picker for each
      }
  }
}
```

### Files to Create/Modify

- `src/commands/startSprint.ts` (new)
- `src/commands/closeSprint.ts` (new)
- `src/core/configWriter.ts` (add updateSprint)
- `src/extension.ts` (register commands)
- `package.json` (add commands)

## Test Cases

### startSprint
1. Start a planned sprint → success
2. Start when another active → handle/warn
3. No planned sprints → show message
4. Cancel confirmation → no change

### closeSprint
1. Close active sprint with all done → success
2. Close with incomplete → handle dialog
3. Move to next sprint
4. Move to backlog
5. Choose individually
6. No active sprint → show message
