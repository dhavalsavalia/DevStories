---
id: DS-033
title: Load .devstories on extension activation
type: bug
epic: EPIC-001
status: done
sprint: backlog
size: S
assignee: ""
dependencies: []
created: 2025-11-28
updated: 2025-11-29
---

# Load .devstories on extension activation

## Problem

Extension doesn't load story data on first activation. User has to save a story file first to trigger the watcher, which then initializes the store and populates the tree view.

## Expected Behavior

When VS Code opens a workspace with `.devstories/` folder:
1. Extension activates (via `workspaceContains:.devstories`)
2. Store immediately loads all stories and epics
3. Tree view populates with data
4. Board view works on first open

## Current Behavior

1. Extension activates
2. Tree view shows empty or stale data
3. User saves a story file
4. Watcher fires, store loads, tree populates

## Root Cause

Two issues found in `extension.ts`:
1. `store.load()` was called but NOT awaited - async timing issue
2. `store.load()` didn't fire `onDidUpdate` event after completing

## Acceptance Criteria

- [x] Store loads on extension activation
- [x] Tree view populated immediately on activation
- [x] Board view shows data on first open
- [x] Works for fresh workspaces (first time opening)
- [x] Works for returning workspaces (data should appear instantly)

## Implementation Notes

### Files Changed
- `src/extension.ts`: Changed `activate()` to async and await `store.load()`
- `src/core/store.ts`: Added `_onDidUpdate.fire()` at end of `load()` method
- `src/test/suite/store.test.ts`: Added test for `onDidUpdate` firing after load

### Root Cause Analysis
The `store.load()` method was being called but not awaited:
```typescript
// Before (bug)
store.load();  // Fire and forget - tree view shows empty

// After (fix)
await store.load();  // Wait for data before continuing
```

Additionally, `store.load()` didn't notify listeners when complete:
```typescript
// Added at end of load()
this._onDidUpdate.fire();
```

### Test Added
Integration test verifies `load()` fires `onDidUpdate` event, ensuring tree view and other listeners get notified when data is ready.
