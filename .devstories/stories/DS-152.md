---
id: DS-152
title: "Migrate config.yaml to config.json with JSON Schema"
type: feature
epic: EPIC-025
status: done
sprint: release-1.0.0
size: M
priority: 100
created: 2025-12-01
updated: 2025-12-01
---

# Migrate config.yaml to config.json with JSON Schema

## Description

Switch from `config.yaml` to `config.json` with JSON Schema validation. This enables VS Code's native JSON features: autocomplete, inline error squiggles, and hover documentation - no extension dependency required.

## Acceptance Criteria

### Schema & VS Code Integration
- [x] Create `schemas/devstories.schema.json`
- [x] Add `contributes.jsonValidation` to `package.json`
- [x] Verify: autocomplete works (Ctrl+Space in config.json)
- [x] Verify: squiggly lines appear for invalid values
- [x] Verify: hover shows field descriptions

### Config Parsing Changes
- [x] `configServiceUtils.ts`: Replace `parseConfigYamlContent()` → `parseConfigJsonContent()`
- [x] `configServiceUtils.ts`: Add `validateSprintConfig()` (currentSprint must exist in sequence)
- [x] `configServiceUtils.ts`: Remove `inlineTemplates` from `ConfigData` interface
- [x] `configService.ts`: Change watcher pattern to `**/.devstories/config.json`
- [x] `configService.ts`: Change load path to `config.json`
- [x] `configService.ts`: Call `validateSprintConfig()` after merge, show error if invalid
- [x] `configServiceNotifications.ts`: Update path reference

### Init Command
- [x] `initUtils.ts`: Replace `generateConfigYaml()` → `generateConfigJson()`
- [x] `init.ts`: Write `config.json` instead of `config.yaml`

### Other Commands
- [x] `createStory.ts`: Read `config.json`
- [x] `createStoryUtils.ts`: Replace `parseConfigYaml()` → `parseConfigJson()`
- [x] `quickCapture.ts`: Read `config.json`
- [x] `changeStatus.ts`: Read `config.json`

### Tests
- [x] `configService.test.ts`: JSON parsing tests, sprint validation tests
- [x] `configService.test.ts` (integration): JSON strings
- [x] `init.test.ts`: Test `generateConfigJson()`

### Migration
- [x] Convert `.devstories/config.yaml` → `.devstories/config.json`
- [x] Convert `devstories_test/.devstories/config.yaml` → `config.json`
- [x] Delete old YAML files

## Schema Fields

| Field | Type | Required | Validation |
|-------|------|----------|------------|
| version | integer | yes | const: 1 |
| project | string | yes | minLength: 1 |
| idMode | string | no | enum: ["auto", "manual"] |
| idPrefix.epic | string | yes | pattern: ^[A-Z]+$ |
| idPrefix.story | string | yes | pattern: ^[A-Z]+$ |
| statuses[].id | string | yes | pattern: ^[a-z_]+$ |
| statuses[].label | string | yes | - |
| sprints.current | string | no | runtime: must exist in sequence |
| sprints.sequence | string[] | no | uniqueItems: true |
| sizes | string[] | yes | enum items: XS/S/M/L/XL |
| quickCapture.defaultToCurrentSprint | boolean | no | default: false |

## Files Changed

**New:**
- `schemas/devstories.schema.json`

**Modified:**
- `package.json`
- `src/core/configService.ts`
- `src/core/configServiceUtils.ts`
- `src/core/configServiceNotifications.ts`
- `src/commands/init.ts`
- `src/commands/initUtils.ts`
- `src/commands/createStory.ts`
- `src/commands/createStoryUtils.ts`
- `src/commands/quickCapture.ts`
- `src/commands/changeStatus.ts`
- `src/test/unit/configService.test.ts`
- `src/test/suite/configService.test.ts`
- `src/test/unit/init.test.ts`

**Deleted:**
- `.devstories/config.yaml`
- `devstories_test/.devstories/config.yaml`
